<!DOCTYPE html>
<html>
<head>
    <title>Proxy Diagnostics</title>
    <meta charset="utf-8">
    <style>body{background:#111;color:#fff;font-family:monospace;padding:20px}</style>
</head>
<body>
    <h2>代理服务诊断 (Proxy Diagnostics)</h2>
    <button onclick="testProxy()">开始测试 (Start Test)</button>
    <div id="log" style="margin-top:20px;white-space:pre-wrap;"></div>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += msg + '\n';
        }

        async function testProxy() {
            log('Wait...');
            const target = 'https://www.baidu.com'; // 测试百度
            // 构造本站的代理地址
            const proxyUrl = '/api/proxy?url=' + encodeURIComponent(target);
            
            log(`Fetching: ${proxyUrl}`);
            
            try {
                const start = performance.now();
                const res = await fetch(proxyUrl);
                const time = performance.now() - start;
                
                log(`Status: ${res.status} ${res.statusText}`);
                log(`Time: ${time.toFixed(0)}ms`);
                
                // 打印 Headers
                log('--- Response Headers ---');
                res.headers.forEach((v, k) => log(`${k}: ${v}`));
                
                const text = await res.text();
                log('--- Body Preview ---');
                log(text.substring(0, 500));
                
            } catch (e) {
                log(`ERROR: ${e.name} - ${e.message}`);
                console.error(e);
            }
        }
    </script>
</body>
</html>
